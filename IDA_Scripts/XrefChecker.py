# Guillaume Orlando
# 04/07/2020
# Check the number of Xref to every functions, and display a sorted result
# Can help to find some deobfuscation / decryption / API hashing function

from idautils import *
from idaapi import *
from idc import *

import operator

result = {}

for seg in Segments():
	for funcs in Functions(seg, SegEnd(seg)):
		localCount = 0
		funcName = GetFunctionName(funcs)
		refs =  XrefsTo(funcs, flags=0)
		for funcRef in refs:
			localCount += 1
			# print(GetFunctionName(funcRef.frm))
		if (localCount != 1 and localCount != 0):
			result[funcName] = localCount

sortedResult = sorted(result.items(), key=operator.itemgetter(1), reverse=True)
for nicePrint in sortedResult:
	print(nicePrint)